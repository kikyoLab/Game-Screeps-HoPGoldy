# 自动运营设计案（设计阶段）

# 自动选址

- 执行 Room.claim 后提示“新增 flag 来确定基地中心，否则将会自行选址”。
- 目标房间有视野时，若还没有目标旗帜，就运行 **选址规划**，列出待选点位。
- claim controller 后，若还没有目标旗帜，就运行 **选址确认**，确定基地中心，移除待选点位。

**选址规划**：搜索房间找出所有适合放置中心点的位置（是否可以容纳布局、沼泽数量最少）。
**选址确认**：在所有适合放置中心点的位置中找到目标位置（到 controller 和 mineral 的总距离最近，若不止一个就随机选取）。
**设置中心点**：手动 api，用于重设中心点，一般不需要调用。

# 自动布局

自动布局分为自动建筑摆放和自动墙体摆放

- 建筑摆放将在 controller 升级触发、房间命令手动触发、全局缓存清除时触发（防止房间被攻击后有建筑损毁）。
    - 找到所有不属于自己的建筑并移除
    - 运行布局规划，从低等级开始遍历所有建筑，并检查目标位置上是不是对应建筑（目标位置由中心点和相对偏移确定）。
- 自动墙体摆放是房间内能量足够时会触发墙体摆放，每次只新增几个墙体，逐渐的将基地包围起来，完成之后将会停止检查，并在全局缓存清除时触发检查。

# 自动 creep 发布

- 刚 claim 控制器后根据 source 空位数量 1:1 发布 harvester 和 upgrader。
- upgrader0 在死亡时会运行 upgrader 规划，重新调整能量获取来源和数量。
- 

运营 creep 的改变时因为房间的状态发生了变化，例如：

- sourceLink 建成 > 对应 source harvester 的目标存放位置发生改变
- storage 建成 > upgrader 的能量来源改变
- storage 中能量数量变化 > 调整 upgrader 的数量

经过观察可以得出如下总结:

**房间中的运营角色**

harvester、collector、upgrader、transfer、centerTransfer

**会引发 creep 改变的触发条件**

房间占领、link 建成及摧毁、terminal 建成及摧毁、extractor 建成及摧毁、storage 建成及摧毁、storage 能量变化、terminal 能量变化。